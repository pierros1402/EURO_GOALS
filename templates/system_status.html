<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>EURO_GOALS – System Status Panel</title>
<style>
body{font-family:Arial,sans-serif;background:#0d1117;color:#fff;margin:0;padding:20px}
h1{text-align:center;color:#00b0ff}
.section-title{font-size:1.2em;margin:25px auto 10px;color:#00b0ff;max-width:1200px}
.panel-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;max-width:1200px;margin:0 auto 20px}
.card{background:#161b22;border:1px solid #30363d;border-radius:12px;padding:18px;text-align:center;transition:.2s}
.card h3{margin-top:0;color:#00b0ff}
.ok-card{border-color:#1b5e20;box-shadow:0 0 12px rgba(76,175,80,.25)}
.down-card{border-color:#8e0000;box-shadow:0 0 14px rgba(244,67,54,.35)}
.nokey-card{border-color:#8d6e00;box-shadow:0 0 12px rgba(255,193,7,.25)}
.banner{display:none;max-width:1200px;margin:0 auto 15px;background:#2a1b1b;border:1px solid #8e0000;color:#ffbfbf;border-radius:10px;padding:10px 14px;box-shadow:0 0 10px rgba(244,67,54,.25)}
.banner.show{display:block}
#log-box{background:#0c1015;border:1px solid #333;border-radius:8px;margin-top:10px;padding:8px;text-align:left;font-family:monospace;color:#aaa;max-height:100px;overflow-y:auto;font-size:.85em}
button{margin-top:10px;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;background:#1976d2;color:#fff}
button:hover{background:#1565c0}
footer{text-align:center;margin:40px 0 10px;font-size:.8em;color:#777}
</style>
</head>
<body>
<h1>⚽ EURO_GOALS – System Status Panel</h1>
<div id="alert-banner" class="banner">—</div>

<!-- Asianconnect panel -->
<div id="ac-card" class="card" style="max-width:500px;margin:0 auto 20px;">
  <h3>Asianconnect API</h3>
  <p><span id="status-text">Έλεγχος...</span></p>
  <p id="timestamp" style="color:#bbb;font-size:.9em"></p>
  <p id="last-good" style="color:#777;font-size:.85em"></p>
  <button onclick="checkStatus()">Έλεγχος τώρα</button>
  <div id="log-box"><strong>📜 Log:</strong><br><div id="logs"></div></div>
</div>

<footer>EURO_GOALS v8.9i – Asianconnect Auto-Recovery + Sound Alerts</footer>

<audio id="alert-sound" src="/static/sounds/alert.mp3" preload="auto"></audio>

<script>
let lastStatus="";
async function checkStatus(){
  try{
    const res=await fetch("/check_asianconnect");
    const data=await res.json();

    const text=document.getElementById("status-text");
    const time=document.getElementById("timestamp");
    const good=document.getElementById("last-good");
    const logs=document.getElementById("logs");
    const card=document.getElementById("ac-card");
    const banner=document.getElementById("alert-banner");
    const sound=document.getElementById("alert-sound");

    card.classList.remove("ok-card","down-card","nokey-card");
    banner.classList.remove("show");

    if(data.status==="OK"){card.classList.add("ok-card");text.textContent="🟢 API reachable";}
    else if(data.status==="DOWN"){card.classList.add("down-card");text.textContent="🔴 "+data.message;}
    else{card.classList.add("nokey-card");text.textContent="🟡 "+data.message;}

    time.textContent="Τελευταίος έλεγχος: "+data.timestamp;
    good.textContent="Τελευταία επιτυχής σύνδεση: "+data.last_good;
    logs.innerHTML=(data.logs||[]).map(l=>"• "+l).join("<br>");

    if(data.banner){banner.textContent=data.banner;banner.classList.add("show");}

    // ---- Sound & Notification logic ----
    if(lastStatus && data.status!==lastStatus){
      sound.currentTime=0;
      sound.play().catch(()=>{});
      if(Notification.permission==="granted"){
        new Notification("Asianconnect API "+data.status,
          {body:data.message,icon:"/static/icon.png"});
      }
    }
    lastStatus=data.status;
  }catch(e){document.getElementById("status-text").textContent="Σφάλμα σύνδεσης.";}
}

if(Notification.permission!=="granted"){Notification.requestPermission();}
checkStatus();
setInterval(checkStatus,60000);
</script>
</body>
</html>
