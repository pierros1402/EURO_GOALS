<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>⚽ EURO_GOALS NextGen</title>

  <!-- PWA -->
  <link rel="manifest" href="/static/manifest.json" />
  <meta name="theme-color" content="#00e676" />
  <link rel="icon" href="/static/icons/eurogoals_192.png" type="image/png" />

  <!-- Service Workers (PWA + Notifications) -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/static/service-worker.js")
        .then(() => console.log("✅ PWA SW ενεργό"))
        .catch(e => console.error("❌ PWA SW:", e));
      navigator.serviceWorker.register("/static/service-worker-notify.js")
        .then(() => console.log("✅ Notify SW ενεργό"))
        .catch(e => console.error("❌ Notify SW:", e));
    }
  </script>

  <!-- UI libs -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <style>
    body { background:#0d1117; color:#e6edf3; font-family:Segoe UI, sans-serif; }
    h1 { color:#00e676; font-size:1.8rem; text-align:center; margin:20px 0 12px; }
    .nav-tabs .nav-link.active { background:#161b22; color:#00e676; border-color:#00e676; }
    .nav-tabs .nav-link { color:#9ca3af; }
    .panel { background:#161b22; border-radius:10px; box-shadow:0 0 10px #00e67633; padding:16px; margin-top:16px; }
    .status-indicator{height:12px;width:12px;border-radius:50%;display:inline-block}
    .status-ok{background:#00e676}.status-fail{background:#ff5252}
    .refresh-btn{background:#00e676;border:none;color:#000;font-weight:bold}
    .muted{color:#94a3b8;font-size:.9rem}
    @media (max-width:600px){ h1{font-size:1.4rem} .nav-link{padding:6px;font-size:.9rem} .panel{padding:12px} }
    pre { background:#0b1320; color:#e6edf3; border-radius:8px; padding:10px; overflow:auto; }
  </style>
</head>

<body>
  <div class="container mt-2 mb-4">
    <h1>⚽ EURO_GOALS NextGen Dashboard</h1>
    <p class="text-center muted">v8.9m · auto-refresh κάθε 15″</p>

    <ul class="nav nav-tabs justify-content-center">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#system">System</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#smart">SmartMoney</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#goal">GoalMatrix</a></li>
    </ul>

    <div class="tab-content mt-3">
      <!-- SYSTEM -->
      <div class="tab-pane fade show active" id="system">
        <div class="panel">
          <div class="d-flex justify-content-between align-items-center">
            <h4 class="m-0">🖥️ System Status</h4>
            <button class="btn refresh-btn btn-sm" onclick="refreshAll()">🔄 Ανανέωση</button>
          </div>
          <div id="systemData" class="mt-3">Φόρτωση...</div>
          <div id="systemMeta" class="muted mt-2"></div>
        </div>
      </div>

      <!-- SMART MONEY -->
      <div class="tab-pane fade" id="smart">
        <div class="panel">
          <h4>💰 Smart Money Monitor</h4>
          <div id="smartData" class="mt-2">Φόρτωση...</div>
        </div>
      </div>

      <!-- GOAL MATRIX -->
      <div class="tab-pane fade" id="goal">
        <div class="panel">
          <h4>📊 Goal Matrix</h4>
          <div id="goalData" class="mt-2">Φόρτωση...</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const fmtTime = () => new Date().toLocaleTimeString();

    async function loadSystem() {
      try {
        const res = await axios.get("/health", { headers: { "cache-control": "no-cache" }});
        const d = res.data;
        const rows = Object.entries(d.components || {}).map(([name, st]) =>
          `<tr><td>${name}</td><td><span class="status-indicator ${st==="OK"?"status-ok":"status-fail"}"></span> ${st}</td></tr>`
        ).join("");
        const html = `<table class="table table-dark table-sm mt-2">
          <tr><th>Υπηρεσία</th><th>Κατάσταση</th></tr>${rows || ""}
        </table>`;
        document.getElementById("systemData").innerHTML = html;
        document.getElementById("systemMeta").textContent = `Τελευταία ενημέρωση: ${fmtTime()}`;
      } catch {
        document.getElementById("systemData").innerHTML = '<span class="text-danger">Σφάλμα φόρτωσης</span>';
      }
    }

    async function loadSmart() {
      try {
        const res = await axios.get("/smartmoney", { headers: { "cache-control": "no-cache" }});
        document.getElementById("smartData").innerHTML = `<pre>${JSON.stringify(res.data, null, 2)}</pre>`;
      } catch {
        document.getElementById("smartData").innerHTML = '<span class="text-danger">Αποτυχία SmartMoney</span>';
      }
    }

    async function loadGoal() {
      try {
        const res = await axios.get("/goal_matrix", { headers: { "cache-control": "no-cache" }});
        document.getElementById("goalData").innerHTML = `<pre>${JSON.stringify(res.data, null, 2)}</pre>`;
      } catch {
        document.getElementById("goalData").innerHTML = '<span class="text-danger">Αποτυχία GoalMatrix</span>';
      }
    }

    function refreshAll() {
      loadSystem(); loadSmart(); loadGoal();
    }

    // Auto-refresh κάθε 15"
    refreshAll();
    setInterval(refreshAll, 15000);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
