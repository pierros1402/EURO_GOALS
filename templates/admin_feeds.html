<!DOCTYPE html>
const r = await fetch('/api/feeds');
const j = await r.json();
feeds = j.feeds || [];
render();
}


function render(){
TBL.innerHTML = '';
feeds.forEach((f,idx)=>{
const tr = el('tr',{},
el('td',{}, el('input',{class:'input', value:f.name||'', oninput:`feeds[${idx}].name=this.value`})),
el('td',{}, el('input',{class:'input', value:f.alias||'', oninput:`feeds[${idx}].alias=this.value`})),
el('td',{}, el('input',{class:'input', value:f.type||'', oninput:`feeds[${idx}].type=this.value`})),
el('td',{}, el('input',{class:'input', value:f.base_url||'', oninput:`feeds[${idx}].base_url=this.value`})),
el('td',{}, (function(){
const s = el('select',{class:'input', onchange:`feeds[${idx}].status=this.value`});
['OK','Pending','Planned','Error'].forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; if(f.status===v) o.selected=true; s.appendChild(o); });
return s;})()
),
el('td',{class:'center'}, (function(){
const c = el('input',{type:'checkbox'}); c.checked = !!f.active; c.onchange = ()=> feeds[idx].active = c.checked; return c;})()
),
el('td',{}, el('input',{class:'input', value:f.fallback||'', oninput:`feeds[${idx}].fallback=this.value`})),
el('td',{}, el('div',{class:'tbl-actions'},
el('button',{class:'btn', onclick:`duplicateRow(${idx})`}, '⎘ Αντιγραφή'),
el('button',{class:'btn', onclick:`deleteRow(${idx})`}, '🗑 Διαγραφή')
))
);
TBL.appendChild(tr);
});
}


function addRow(){
feeds.push({name:'New Feed', alias:'alias', type:'type', base_url:'https://', status:'Pending', active:false, fallback:'none'});
render();
}
function duplicateRow(i){ feeds.splice(i+1,0, JSON.parse(JSON.stringify(feeds[i])) ); render(); }
function deleteRow(i){ if(confirm('Διαγραφή πηγής;')) { feeds.splice(i,1); render(); } }


async function saveChanges(){
const r = await fetch('/api/feeds/save', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({feeds})});
const j = await r.json();
alert(j.ok? `Αποθηκεύτηκαν (${j.count}) πηγές.` : ('Σφάλμα: '+(j.error||'unknown')));
}


async function reloadFeeds(){ await loadFeeds(); alert('Τα feeds επαναφορτώθηκαν.'); }


loadFeeds();
</script>
</body>
</html>